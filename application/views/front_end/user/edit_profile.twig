{% extends "front_end/base.twig" %}

{% block head %}
{% endblock %}

{% block content %}
    <div class="container">
        <div class="row">
            <div class="col-md-5 col-center">
                <div class="box">
                    <div class="panel-form basic-form form">
                        <h2>Edit Profile</h2>
                        <form action="{{ function('site_url','front_end/profile/update_profile/'~user.user_id) }}" method="POST" enctype="multipart/form-data" id="edit-profile" class="form-horizontal" style="padding-left:15px;padding-right:15px">
                            <div class="form-group">
                                <div class="ava-image">
                                    <span>
                                        <img id="profile-image" class="placeholder-img" src="{{ function('base_url', user.profile_picture|default('assets/images/home/header/default-avatar.png')) }}" alt="{{ user.name }}" />
                                    </span>

                                    <label for="input-profile-picture" class="edit-photo">
                                        <i class="fa fa-pencil" style="padding-left:25%"></i>
                                    </label>
                                    <input type="file" name="profile_picture" accept="image/*" id="input-profile-picture">
                                </div>
                            </div>
                            <div class="form-group">
                                <input type="hidden" name="level_user" value="{{ user.level_user }}" class="form-control">
                                <input type="text" name="name" value="{{ user.name }}" class="form-control" placeholder="Nama Lengkap" required="" autocomplete="false">
                            </div>
                            <div class="form-group">
                                <input type="text" name="email" value="{{ user.email }}" class="form-control" placeholder="Email" required="" autocomplete="false">
                            </div>
                            <div class="form-group">
                                <input type="text" name="username" value="{{ user.username }}" class="form-control" placeholder="Nama Pengguna" readonly="">
                            </div>
                            <div class="form-group">
                                <label class="col-xs-3 control-label no-padding" style="text-align:left">Jenis Kelamin </label>
                                <div class="col-xs-9 no-padding">
                                    <div class="radio no-padding">
                                        <label><input type="radio" name="gender" value="male" {{ user.gender == 'male' ? 'checked' : '' }}>Laki-laki</label>
                                        <label><input type="radio" name="gender" value="female" {{ user.gender == 'female' ? 'checked' : '' }}>Perempuan</label>
                                    </div>
                                </div>
                            </div>

                            <div class="form-group">
                                <input  type="text" name="born_date" id="born_date" data-born_date="{{ user.born_date|date("d/m/Y") }}" class="form-control" placeholder="Tanggal Lahir" required="" autocomplete="false">
                            </div>

                            <div class="form-group">
                                <input type="password" name="password" class="form-control" placeholder="Ubah kata sandi">
                            </div>

                            <div class="form-group">
                                <input type="password" name="confirm_password" class="form-control" placeholder="Ulang Kata sandi">
                            </div>
                            <div class="row">
                            <button type="submit" name="submitButton" class="btn btn-block btn-login btn-lg">Simpan</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block footer %}
    <script type="text/javascript" src="{{ function('base_url','assets/includes/jquery-form/dist/jquery.form.min.js') }}"></script>
    <script>
        var user_id = {{ user.user_id|json_encode|raw }}
        // config datepicker borndate
        $('#born_date').datetimepicker({
            locale: moment.locale('id', {
                months: ['Januari', 'Februari', 'Maret', 'April', 'Mei', 'Juni', 'Juli', 'Agustus', 'September', 'Oktober', 'November', 'Desember'],
                monthsShort: ['Jan', 'Feb', 'Mar', 'Apr', 'Mei', 'Jun', 'Jul', 'Agu', 'Sep', 'Okt', 'Nov', 'Des']
            }),
            format: 'DD/MM/YYYY',
            maxDate: moment().add(-20, 'years').endOf('years'), // set last month of -20 years from now
            minDate: moment().add(-28, 'years').endOf('years'), // set last month of -2 years from now
            defaultDate: ''
        });

        $('#born_date').val($('#born_date').data('born_date')); // remove initial value
        
        $('#born_date').on('dp.change dp.show', function () {
            $('#update-profile').formValidation('revalidateField', 'born_date');
        });

        // config form validation
        $('#edit-profile').formValidation({
            framework: 'bootstrap',
            icon: {
                valid: 'glyphicon glyphicon-ok',
                invalid: 'glyphicon glyphicon-remove',
                validating: 'glyphicon glyphicon-refresh'
            },
            fields: {
                name: {
                    validators: {
                        notEmpty: {
                            message: 'Nama Lengkap tidak boleh kosong'
                        }
                    }
                },
                email: {
                    validators: {
                        emailAddress: {
                            message: 'Email tidak valid'
                        },
                        notEmpty: {
                            message: 'Email tidak boleh kosong'
                        }
                    }
                },
                username: {
                    validators: {
                        notEmpty: {
                            message: 'Username tidak boleh kosong'
                        },
                        stringLength: {
                            max: 30,
                            message: 'The username must be less than 30 characters long'
                        },
                        regexp: {
                            regexp: /^[a-zA-Z0-9_\.]+$/,
                            message: 'Username tidak boleh menggunakan symbol'
                        }
                    }
                },
                gender: {
                    validators: {
                        notEmpty: {
                            message: 'Pilih jenis kelamin'
                        }
                    }
                },
                born_date: {
                    validators: {
                        notEmpty: {
                            message: 'Tanggal lahir tidak boleh kosong'
                        },
                        regexp: {
                            regexp: /^[0-9]{2}\/+[0-9]{2}\/+[0-9]{4}$/,
                            message: 'Masukan dengan format DD/MM/YYYY'
                        }
                    }
                },
                password: {
                    validators: {
                        stringLength: {
                            min: 6,
                            max: 15,
                            message: 'Password terlalu pendek'
                        }
                    }
                },
                confirm_password: {
                    validators: {
                        identical: {
                            field: 'password',
                            message: 'Password tidak sesuai'
                        }
                    }
                }
            }
        });
        $("#edit-profile #input-profile-picture").on('change', function () {
            var input = this;
            $("#edit-profile").ajaxSubmit({
                type: "post",
                url: site_url('front_end/profile/upload_picture/'+user_id),
                dataType: 'json',
                success: function (status, message, data) {
                    if (status) {
                        $('#profile-image').attr('src', base_url(data.responseJSON.data));
                    }
                }
            });
        });
    </script>
{% endblock %}